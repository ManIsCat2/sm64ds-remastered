#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"

#include "game/level_update.h"

#include "levels/scripts.h"

#include "actors/common1.h"

#include "make_const_nonconst.h"
#include "levels/wf/header.h"

static const LevelScript script_func_local_1[] = {
		OBJECT_WITH_ACTS(MODEL_STAR, 476, 5550, 41, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_2), bhvStar, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_STAR, -2510, 1403, -703, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_3), bhvStar),
		OBJECT(MODEL_STAR, 4567, 4301, -154, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_5), bhvStar),
		OBJECT(MODEL_STAR, 584, 2381, 2683, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_6), bhvStar),
		OBJECT(MODEL_WF_BREAKABLE_WALL_LEFT, -1024, 2176, 2944, 0, 0, 0, 0, bhvWFBreakableWallLeft),
		OBJECT(MODEL_WF_BREAKABLE_WALL_RIGHT, 512, 2176, 2944, 0, 0, 0, 0, bhvWFBreakableWallRight),
		OBJECT_WITH_ACTS(MODEL_BULLET_BILL, 1280, 3584, 922, 0, 180, 0, 0, bhvBulletBillCannon, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_WF_ROTATING_PLATFORM, 3482, 3584, -3635, 0, 0, 0, BPARAM1(8) | BPARAM2(ROTATING_PLATFORM_BP_WF), bhvRotatingPlatform),
		OBJECT(MODEL_WF_ROTATING_PLATFORM, 4378, 3328, -3123, 0, 0, 0, BPARAM1(8) | BPARAM2(ROTATING_PLATFORM_BP_WF), bhvRotatingPlatform),
		OBJECT(MODEL_WF_ROTATING_PLATFORM, 4864, 3584, -2202, 0, 0, 0, BPARAM1(8) | BPARAM2(ROTATING_PLATFORM_BP_WF), bhvRotatingPlatform),
		OBJECT(MODEL_NONE, -2560, 2560, -262, 0, 0, 0, 0, bhvGiantPole),
		OBJECT(MODEL_GOOMBA, -2406, 2560, -614, 0, 0, 0, 0, bhvGoomba),
		OBJECT(MODEL_GOOMBA, -2241, 708, 1869, 0, 0, 0, 0, bhvGoomba),
		OBJECT(MODEL_GOOMBA, -2765, 384, 205, 0, 0, 0, 0, bhvGoomba),
		OBJECT_WITH_ACTS(MODEL_WF_KICKABLE_BOARD, 13, 3584, -1408, 0, -45, 0, 0, bhvKickableBoard, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_WF_LARGE_BOMP, 3835, 1070, 614, 0, 0, 0, 0, bhvLargeBomp),
		OBJECT(MODEL_LUIGIS_CAP, 3840, 1075, -3891, 0, 0, 0, 0, bhvLuigiCap),
		OBJECT(MODEL_NONE, -2495, 1331, -256, 0, 0, 0, BPARAM2(0x3D), bhvPoleGrabbing),
		OBJECT(MODEL_NONE, 4608, 307, 2765, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_4), bhvHiddenRedCoinStar),
		OBJECT(MODEL_WF_ROTATING_WOODEN_PLATFORM, -256, 2560, 2304, 0, 0, 0, 0, bhvWFRotatingWoodenPlatform),
		OBJECT(MODEL_WF_SLIDING_PLATFORM, 3328, 1075, -768, 0, 90, 0, 0, bhvWFSlidingPlatform),
		OBJECT(MODEL_WF_SLIDING_PLATFORM, 3328, 1075, -1792, 0, 90, 0, 0, bhvWFSlidingPlatform),
		OBJECT(MODEL_WF_SLIDING_PLATFORM, 3328, 1075, -2816, 0, 90, 0, 0, bhvWFSlidingPlatform),
		OBJECT(MODEL_WF_SMALL_BOMP, 3835, 1070, 0, 0, 90, 0, 0, bhvSmallBomp),
		OBJECT(MODEL_WF_SMALL_BOMP, 3835, 1070, 1229, 0, 90, 0, 0, bhvSmallBomp),
		OBJECT(MODEL_STAR_SWITCH, 3768, 102, -1792, 0, 90, 0, BPARAM2(35), bhvStarSwitch),
		OBJECT(MODEL_NONE, -2560, 538, -2560, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_7), bhvBitdwStarSwitchSpawnCondition),
		OBJECT_WITH_ACTS(MODEL_LEVEL_GEOMETRY_08, 0, 3584, 0, 0, 0, 0, 0, bhvTower, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_DOOR, -512, 3584, 0, 0, 0, 0, 0, bhvTowerDoor, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, 502, 3891, 502, 0, 45, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, 502, 4096, -502, 0, 135, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, -502, 4301, -502, 0, -135, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, -502, 4506, 502, 0, -45, 0, 0, bhvWFElevatorTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, 0, 3789, 717, 0, 0, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, 732, 3994, 0, 0, 90, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, 0, 4198, -717, 0, 180, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_WF_TOWER_SQUARE_PLATORM, -717, 4403, 0, 0, -90, 0, 0, bhvWFSlidingTowerPlatform, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT(MODEL_WF_BUBBLY_TREE, 2560, 256, 4608, 0, 0, 0, 0, bhvTree),
		OBJECT(MODEL_WF_TUMBLING_BRIDGE, 1792, 2495, 1600, 0, 0, 0, BPARAM2(TUMBLING_BRIDGE_BP_WF), bhvTumblingBridge),
		OBJECT(MODEL_CHECKERBOARD_PLATFORM, 973, 2693, -870, 0, 45, 0, 0, bhvCheckerboardElevatorGroup),
		OBJECT(MODEL_WARIOS_CAP, 2970, 2304, -307, 0, 0, 0, 0, bhvWarioCap),
		OBJECT_WITH_ACTS(MODEL_1UP, -410, 3584, 0, 0, 0, 0, 0, bhv1Up, ACT_2 | ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_1UP, 3154, 1075, -3850, 0, 0, 0, 0, bhv1Up, ACT_1 | ACT_2),
		OBJECT_WITH_ACTS(MODEL_1UP, 4040, 102, -5023, 0, 0, 0, 0, bhv1Up, ACT_1 | ACT_2),
		OBJECT_WITH_ACTS(MODEL_MARIOS_CAP, 2068, 2560, 2806, 0, 140, 0, 0, bhvMarioCap, ACT_1 | ACT_2),
		OBJECT_WITH_ACTS(MODEL_WHOMP, 721, 3584, 722, 0, -135, 0, 0, bhvWhompKingBoss, ACT_1),
		OBJECT_WITH_ACTS(MODEL_BOBOMB_BUDDY, -1741, 1024, 3584, 0, -90, 0, DIALOG_047, bhvBobombBuddyOpensCannon, ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_GOOMBA, 4301, 102, -1331, 0, 0, 0, 0, bhvGoomba, ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_HOOT, 2560, 461, 4608, 0, 0, 0, 0, bhvHoot, ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_1UP, 3154, 1075, -3850, 0, 0, 0, 0, bhvHidden1UpTrigger, ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_1UP, 4040, 102, -5023, 0, 0, 0, 0, bhvHidden1UpTrigger, ACT_3 | ACT_4 | ACT_5 | ACT_6),
		OBJECT_WITH_ACTS(MODEL_BOBOMB_BUDDY, 2714, 256, 4454, 0, 90, 0, DIALOG_175, bhvBobombBuddy, ACT_4),
    RETURN(),
};

const LevelScript level_wf_entry[] = {
    INIT_LEVEL(),
    LOAD_MIO0(0x07, _wf_segment_7SegmentRomStart, _wf_segment_7SegmentRomEnd),
    LOAD_MIO0(0x0A, _cloud_floor_skybox_mio0SegmentRomStart, _cloud_floor_skybox_mio0SegmentRomEnd),
    LOAD_MIO0_TEXTURE(0x09, _grass_mio0SegmentRomStart, _grass_mio0SegmentRomEnd),
    LOAD_MIO0(0x05, _group1_mio0SegmentRomStart, _group1_mio0SegmentRomEnd),
    LOAD_RAW(0x0C, _group1_geoSegmentRomStart,  _group1_geoSegmentRomEnd),
    LOAD_MIO0(0x06, _group14_mio0SegmentRomStart, _group14_mio0SegmentRomEnd),
    LOAD_RAW(0x0D, _group14_geoSegmentRomStart,  _group14_geoSegmentRomEnd),
    LOAD_MIO0(0x08, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd),
    LOAD_RAW(0x0F, _common0_geoSegmentRomStart,  _common0_geoSegmentRomEnd),
    ALLOC_LEVEL_POOL(),
    MARIO(MODEL_MARIO, BPARAM4(1), bhvPlayer),
    JUMP_LINK(script_func_global_1),
    JUMP_LINK(script_func_global_2),
    JUMP_LINK(script_func_global_15),
    LOAD_MODEL_FROM_GEO(MODEL_WF_BUBBLY_TREE,                   bubbly_tree_geo),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_03,                wf_geo_0007E0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_04,                wf_geo_000820),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_05,                wf_geo_000860),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_06,                wf_geo_000878),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_07,                wf_geo_000890),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_08,                wf_tower_geo),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_09,                wf_geo_0008E8),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0A,                wf_geo_000900),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0C,                wf_geo_000940),
    LOAD_MODEL_FROM_GEO(MODEL_WF_GIANT_POLE,                    wf_geo_000AE0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0E,                wf_geo_000958),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0F,                wf_geo_0009A0),
    LOAD_MODEL_FROM_GEO(MODEL_WF_ROTATING_PLATFORM,             wf_geo_0009B8),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_11,                wf_geo_0009D0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_12,                wf_geo_0009E8),
    LOAD_MODEL_FROM_GEO(MODEL_WF_SMALL_BOMP,                    small_bomp_geo),
    LOAD_MODEL_FROM_GEO(MODEL_WF_LARGE_BOMP,                    large_bomp_geo),
    LOAD_MODEL_FROM_GEO(MODEL_WF_ROTATING_WOODEN_PLATFORM,      wf_geo_000A58),
    LOAD_MODEL_FROM_GEO(MODEL_WF_SLIDING_PLATFORM,              wf_sliding_platform_geo),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TUMBLING_BRIDGE_PART,          wf_geo_000AB0),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TUMBLING_BRIDGE,               wf_geo_000AC8),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TOWER_TRAPEZOID_PLATORM,       wf_geo_000AF8),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TOWER_SQUARE_PLATORM,          wf_geo_000B10),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TOWER_SQUARE_PLATORM_UNUSED,   wf_geo_000B38),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TOWER_SQUARE_PLATORM_ELEVATOR, wf_geo_000B60),
    LOAD_MODEL_FROM_GEO(MODEL_WF_BREAKABLE_WALL_RIGHT,          breakable_wall_right_geo),
    LOAD_MODEL_FROM_GEO(MODEL_WF_BREAKABLE_WALL_LEFT,           breakable_wall_left_geo),
    LOAD_MODEL_FROM_GEO(MODEL_WF_KICKABLE_BOARD,                wf_kickable_board_geo),
    LOAD_MODEL_FROM_GEO(MODEL_WF_TOWER_DOOR,                    wf_geo_000940),
    LOAD_MODEL_FROM_GEO(MODEL_WF_KICKABLE_BOARD_FELLED,         wf_kickable_board_felled_geo),

    AREA(1, wf_geo),
        OBJECT(MODEL_NONE, 3174, 1997, 4506, 0, 90, 0, BPARAM2(0x0A), bhvSpinAirborneWarp),
        WARP_NODE(WARP_NODE_0A, LEVEL_WF, 1, WARP_NODE_0A, WARP_NO_CHECKPOINT),
        WARP_NODE(WARP_NODE_0B, LEVEL_WF, 1, WARP_NODE_0C, WARP_NO_CHECKPOINT),
        WARP_NODE(WARP_NODE_0C, LEVEL_WF, 1, WARP_NODE_0B, WARP_NO_CHECKPOINT),
        WARP_NODE(WARP_NODE_SUCCESS, LEVEL_CASTLE, 1, WARP_NODE_34, WARP_NO_CHECKPOINT),
        WARP_NODE(WARP_NODE_DEATH, LEVEL_CASTLE, 1, WARP_NODE_66, WARP_NO_CHECKPOINT),
        JUMP_LINK(script_func_local_1),
        TERRAIN(wf_col),
        MACRO_OBJECTS(macro_wf),
        SHOW_DIALOG(0, DIALOG_030),
        SET_BACKGROUND_MUSIC(5, SEQ_LEVEL_GRASS),
        TERRAIN_TYPE(TERRAIN_STONE),
    END_AREA(),

    FREE_LEVEL_POOL(),
    MARIO_POS(1, 90, 3174, 949, 4506),
    CALL(0, lvl_init_or_update),
	CALL_LOOP(1, lvl_init_or_update),
    CLEAR_LEVEL(),
    SLEEP_BEFORE_EXIT(1),
    EXIT(),
};
