#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"

#include "game/level_update.h"

#include "levels/scripts.h"

#include "actors/common1.h"

#include "make_const_nonconst.h"
#include "levels/bitdw/header.h"

const LevelScript level_bitdw_entry[] = {
	INIT_LEVEL(),
	LOAD_MIO0(0x07, _bitdw_segment_7SegmentRomStart, _bitdw_segment_7SegmentRomEnd),
    LOAD_MIO0(0x0A, _bidw_skybox_mio0SegmentRomStart, _bidw_skybox_mio0SegmentRomEnd),
    LOAD_MIO0_TEXTURE(0x09, _sky_mio0SegmentRomStart, _sky_mio0SegmentRomEnd),
    LOAD_MIO0(0x05, _group11_mio0SegmentRomStart, _group11_mio0SegmentRomEnd),
    LOAD_RAW(0x0C, _group11_geoSegmentRomStart,  _group11_geoSegmentRomEnd),
    LOAD_MIO0(0x06, _group17_mio0SegmentRomStart, _group17_mio0SegmentRomEnd),
    LOAD_RAW(0x0D, _group17_geoSegmentRomStart,  _group17_geoSegmentRomEnd),
    LOAD_MIO0(0x08, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd),
    LOAD_RAW(0x0F, _common0_geoSegmentRomStart,  _common0_geoSegmentRomEnd),
    ALLOC_LEVEL_POOL(),
    MARIO(MODEL_MARIO, BPARAM4(0x01), bhvPlayer),
    JUMP_LINK(script_func_global_12),
    JUMP_LINK(script_func_global_18),
    JUMP_LINK(script_func_global_1),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_03,       geo_bitdw_0003C0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_04,       geo_bitdw_0003D8),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_05,       geo_bitdw_0003F0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_06,       geo_bitdw_000408),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_07,       geo_bitdw_000420),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_08,       geo_bitdw_000438),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_09,       geo_bitdw_000450),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0A,       geo_bitdw_000468),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0B,       geo_bitdw_000480),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0C,       geo_bitdw_000498),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0D,       geo_bitdw_0004B0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0E,       geo_bitdw_0004C8),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_0F,       geo_bitdw_0004E0),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_10,       geo_bitdw_0004F8),
    LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_11,       geo_bitdw_000510),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_WARP_PIPE,         warp_pipe_geo),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_SQUARE_PLATFORM,   geo_bitdw_000558),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_SEESAW_PLATFORM,   geo_bitdw_000540),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_SLIDING_PLATFORM,  geo_bitdw_000528),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_FERRIS_WHEEL_AXLE, geo_bitdw_000570),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_BLUE_PLATFORM,     geo_bitdw_000588),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_STAIRCASE_FRAME4,  geo_bitdw_0005A0),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_STAIRCASE_FRAME3,  geo_bitdw_0005B8),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_STAIRCASE_FRAME2,  geo_bitdw_0005D0),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_STAIRCASE_FRAME1,  geo_bitdw_0005E8),
    LOAD_MODEL_FROM_GEO(MODEL_BITDW_STAIRCASE,         geo_bitdw_000600),

	AREA(1, bitdw_area_1),
		WARP_NODE(WARP_NODE_0A, LEVEL_BITDW, 1, WARP_NODE_0A, WARP_NO_CHECKPOINT),
		WARP_NODE(WARP_NODE_0B, LEVEL_BOWSER_1, 1, WARP_NODE_0A, WARP_NO_CHECKPOINT),
		WARP_NODE(WARP_NODE_0C, LEVEL_BITDW, 1, WARP_NODE_0C, WARP_NO_CHECKPOINT),
		WARP_NODE(WARP_NODE_DEATH, LEVEL_CASTLE, 1, WARP_NODE_25, WARP_NO_CHECKPOINT),
		OBJECT(MODEL_1UP, -461, 4686, -184, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_1UP, 589, 4686, -184, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_1UP, 102, 5505, 307, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_1UP, 1126, 5710, 307, 0, 0, 0, 0x00000000, bhv1Up),
		OBJECT(MODEL_NONE, 6449, 7349, 0, 0, 90, 0, BPARAM2(WARP_NODE_0C), bhvDeathWarp),
		OBJECT(MODEL_BITDW_FERRIS_WHEEL_AXLE, -205, 1737, 3381, 0, 0, 0, BPARAM2(0x01), bhvFerrisWheelAxle),
		OBJECT(MODEL_NONE, -3089, 851, 2991, 0, 0, 0, 0x00000000, bhvFlamethrower),
		OBJECT(MODEL_NONE, 2465, 1261, 2992, 0, 0, 0, 0x00000000, bhvFlamethrower),
		OBJECT(MODEL_BITDW_SQUARE_PLATFORM, -2963, 4679, -2464, 0, 0, 0, BPARAM2(0x00), bhvSquarishPathMoving),
		OBJECT(MODEL_BITDW_SQUARE_PLATFORM, -2349, 4679, -1849, 0, 90, 0, BPARAM2(0x02), bhvSquarishPathMoving),
		OBJECT(MODEL_BITDW_SQUARE_PLATFORM, -2359, 4679, -1235, 0, 0, 0, BPARAM2(0x00), bhvSquarishPathMoving),
		OBJECT(MODEL_BITDW_SQUARE_PLATFORM, -1745, 4679, -621, 0, 90, 0, BPARAM2(0x02), bhvSquarishPathMoving),
		OBJECT(MODEL_BITDW_SQUARE_PLATFORM, -1966, 508, 3586, 0, 0, 0, BPARAM2(0x00), bhvSquarishPathMoving),
		OBJECT(MODEL_BITDW_SQUARE_PLATFORM, -1352, 508, 4200, 0, 90, 0, BPARAM2(0x02), bhvSquarishPathMoving),
		OBJECT(MODEL_NONE, 7168, 6632, 0, 0, 0, 0, BPARAM1(STAR_INDEX_ACT_1), bhvBowserCourseRedCoinStar),
		OBJECT(MODEL_RED_COIN, -7803, 611, 4915, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -3092, 819, 4516, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -6451, 3753, 835, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -4700, 4815, -2161, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -3192, 4785, -2502, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -4603, 4840, -512, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, -998, 5505, 512, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_COIN, 1490, 4686, -184, 0, 0, 0, 0x00000000, bhvRedCoin),
		OBJECT(MODEL_RED_SWITCH, 3948, 5403, -6, 0, 0, 0, 0x00000000, bhvFloorSwitchAnimatesObject),
		OBJECT(MODEL_BITDW_SEESAW_PLATFORM, 1490, 4935, 512, 0, 90, 0, 0x00000000, bhvSeesawPlatform),
		OBJECT(MODEL_BITDW_SEESAW_PLATFORM, -147, 4556, 512, 0, 90, 0, 0x00000000, bhvSeesawPlatform),
		OBJECT(MODEL_BITDW_SLIDING_PLATFORM, -5728, 4481, -2151, 0, 0, 0, BPARAM1(0x03) | BPARAM2(0xCE), bhvSlidingPlatform2),
		OBJECT(MODEL_BITDW_STAIRCASE, 5279, 5403, -6, 0, 0, 0, BPARAM2(0x01), bhvAnimatesOnFloorSwitchPress),
		OBJECT(MODEL_STAR_SWITCH, 6810, 6528, -358, 0, 0, 0, BPARAM2(25), bhvStarSwitch),
		OBJECT(MODEL_NONE, -998, 5761, -51, 0, 0, 0, BPARAM1(2), bhvStarSwitchSpawnCondition),
		OBJECT(MODEL_NONE, -7578, 1409, 3891, 0, 90, 0, BPARAM2(WARP_NODE_0A), bhvSpinAirborneWarp),
		MARIO_POS(0x01, 90, -7578, 1409, 3891),
		OBJECT(MODEL_BITDW_WARP_PIPE, 6815, 6529, -6, 0, 0, 0, BPARAM2(WARP_NODE_0B), bhvWarpPipe),
		OBJECT(MODEL_YELLOW_COIN, -1664, 693, 3584, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1869, 693, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1971, 693, 3891, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1869, 693, 4096, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1664, 693, 4198, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1459, 693, 4096, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1357, 693, 3891, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1459, 693, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1946, 1302, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1792, 1398, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1638, 1494, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1485, 1591, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1331, 1635, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -205, 2510, 3686, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2406, 2341, 2150, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2406, 2396, 1997, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2406, 2449, 1843, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2406, 2501, 1690, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2406, 2553, 1536, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2355, 4891, -2458, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2355, 4993, -2458, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2355, 5096, -2458, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2048, 4891, -1229, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2253, 4891, -1126, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2355, 4891, -922, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2253, 4891, -717, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2048, 4891, -614, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1843, 4891, -717, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1741, 4891, -922, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -1843, 4891, -1126, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -2473, 4474, 809, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -3072, 4474, 809, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -3676, 4536, 635, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4076, 4677, 229, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4608, 4789, -614, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4813, 4789, -512, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4915, 4789, -307, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4813, 4789, -102, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4608, 4789, 0, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4403, 4789, -102, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4301, 4789, -307, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -4403, 4789, -512, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -148, 4737, 307, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -148, 4737, 512, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, -148, 4737, 717, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1490, 5096, 307, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1490, 5096, 512, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 1490, 5096, 717, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 2765, 5505, 102, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 2765, 5505, 512, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 4352, 5761, 0, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 4659, 6017, 0, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 4966, 6273, 0, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 5274, 6529, 0, 0, 0, 0, 0x00000000, bhvYellowCoin),
		OBJECT(MODEL_YELLOW_COIN, 5530, 6683, 0, 0, 0, 0, 0x00000000, bhvYellowCoin),
		TERRAIN(bitdw_area_1_collision),
		MACRO_OBJECTS(bitdw_area_1_macro_objs),
		SET_BACKGROUND_MUSIC(0x00, SEQ_LEVEL_KOOPA_ROAD),
		SHOW_DIALOG(0x00, DIALOG_090),
		TERRAIN_TYPE(TERRAIN_STONE),
	END_AREA(),

	FREE_LEVEL_POOL(),
	MARIO_POS(0x01, 90, -7578, 1409, 3891),
	CALL(0, lvl_init_or_update),
	CALL_LOOP(1, lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(1),
	EXIT(),
};
